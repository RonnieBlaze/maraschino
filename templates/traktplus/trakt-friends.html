{% extends "traktplus/trakt-base.html" %}
{% block trakt_title %}{{ title }}{% endblock %}
{% block trakt_content %}
{% if friends %}

<div class="friends">
  <ul>
    {% if pending %}
      {% for req in pending %}
        <li class="trakt_user addloading pending" data-username="{{ req.user.username }}">
          <img src="/static/images/trakt/poster.png"/>
          <span class="user_name"><b>{{ req.user.username }}</b></span>
          <b>This user has sent you a friend request.</b>

          <div class="req_buttons">
            <span class="req_btn friend_action" data-action="approve" data-user="{{ req.id }}">Approve</span>
            <span class="req_btn friend_action" data-action="deny" data-user="{{ req.id }}">Deny</span>
          </div>
        </li>
      {% endfor %}
    {% endif %}
    {% for friend in friends %}
      <li class="trakt_user addloading" data-username="{{ friend.user.username }}">

        {% if friend.user.images.avatar.full %}
          <img src="{{ friend.user.images.avatar.full }}">
        {% endif %}

        <span class="user_name"><b>{{ friend.user.username }}</b></span>

        {% if friend.watching %}
          {% if friend.watching.episode %}
            <b>Currently watching: </b>
            <span>
              <span class="goto_show list_link addloading" data-id="{{ friend.watching.show.ids.slug }}">
                {{ friend.watching.show.title }}
              </span>
                <span
                  class="goto_episode list_link addloading" 
                  data-id="{{ friend.watching.show.ids.slug }}" 
                  data-season="{{ friend.watching.episode.season }}"
                  data-episode="{{ friend.watching.episode.number }}"
                >
                  {{ friend.watching.episode.season }}x{{ friend.watching.episode.number }} - {{ friend.watching.episode.title }}
                </span>
            </span>
          {% else %}
            <b>Currently watching: </b>
            <span class="list_link goto_movie addloading" data-id="{{ friend.watching.movie.ids.slug }}">
              {{ friend.watching.movie.title }} ({{ friend.watching.movie.year }})
            </span>
          {% endif %}
        {% else %}
          {% if friend.watched %}
            {% if friend.watched.0.episode %}
              <b>Recently watched: </b>
              <span>
                <span class="goto_show list_link addloading" data-id="{{ friend.watched.0.show.ids.slug }}">
                  {{ friend.watched.0.show.title }}
                </span>
                <span
                  class="goto_episode list_link addloading" 
                  data-id="{{ friend.watched.0.show.ids.slug }}" 
                  data-season="{{ friend.watched.0.episode.season }}"
                  data-episode="{{ friend.watched.0.episode.number }}"
                >
                  {{ friend.watched.0.episode.season }}x{{ friend.watched.0.episode.number }} - {{ friend.watched.0.episode.title }}
                </span>
              </span>
            {% else %}
              <b>Recently watched: </b>
              <span class="list_link goto_movie addloading" data-id="{{ friend.watched.0.movie.ids.slug }}">
                {{ friend.watched.0.movie.title }} ({{ friend.watched.0.movie.year }})
              </span>
            {% endif %}
          {% endif %}
        {% endif %}

      </li>
    {% endfor %}
  </ul>
</div>

{% endif %}
{% endblock %}
