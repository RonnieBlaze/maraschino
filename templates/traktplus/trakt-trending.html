{% extends "traktplus/trakt-base.html" %}
{% block trakt_title %}{{ title }}{% endblock %}
{% block trakt_content %}
{% if trending %}

<div class="trakt_choices">
  <b>{{ type }}</b>
  {% if type == 'Movies' %}
    <a class="button addloading" data-xhr_url="trending/shows">Shows</a>
  {% else %}
    <a class="button addloading" data-xhr_url="trending/movies">Movies</a>
  {% endif %}
</div>

<div class="trending">
  <div id="carousel">
    {% if type == 'Shows' %}
      {% for item in trending %}
        <div
          class="poster"
          data-type="{{ type[:-1]|lower }}"
          data-title="{{ item.show.title }}"
          data-year="{{ item.show.year }}"
          data-imdb_id="{{ item.show.ids.imdb }}"
          data-tvdb_id="{{ item.show.ids.tvdb }}"
        >
          <div
            class="goto_{{ type[:-1]|lower }} addloading"
            data-id="{{ item.show.ids.slug }}"
          >
            <img alt="" src="{{ item.show.images.poster.thumb }}" height="141" width="95"/>
  
            {% if item.show.in_collection %}
              <div class="collection"></div>
            {% endif %}
            {% if item.show.in_watchlist %}
              <div class="watchlist"></div>
            {% endif %}
            {% if item.show.rating %}
              {% if item.show.rating == 'love' %}
                <div class="love"></div>
              {% elif item.show.rating == 'hate' %}
                <div class="hate"></div>
              {% endif %}
            {% endif %}
            {% if item.show.watched %}
              <div class="watched"></div>
            {% endif %}
          </div>
  
          <div class="overlay_menu" align="center">
            {% if not item.show.watched %}
              <div class="mark_watched" title="Mark as watched"></div>
            {% endif %}
            {% if not item.show.in_watchlist %}
              <div class="add_watchlist" title="Add to watchlist"></div>
            {% endif %}
            <div class="add_customlist" title="Add to custom list"></div>
            {% if not item.show.in_collection %}
              <div class="add_collection" title="Add to collection"></div>
            {% endif %}
          </div>
          <div class="footer">
            <div class="item_info">
            <span class="percentage">{{ (item.show.rating * 10)|round|int }}%</span>
            <span class="votes">{{ item.show.votes }} votes</span>
            </div>
            <div class="item_rate" align="center">
              <div class="rate r_love {{ 'rated' if item.show.rating == 'love' }}" data-rating="love" {% if item.show.rating == 'love' %}title="Unrate"{% else %}title="Loved"{% endif %}></div>
              <div class="rate r_hate {{ 'rated' if item.show.rating == 'hate' }}" data-rating="hate" {% if item.show.rating == 'hate' %}title="Unrate"{% else %}title="Hated"{% endif %}></div>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      {% for item in trending %}
  		  <div
  			class="poster"
  			data-type="{{ type[:-1]|lower }}"
  			data-title="{{ item.movie.title }}"
  			data-year="{{ item.movie.year }}"
  			data-imdb_id="{{ item.movie.ids.imdb }}"
  			data-tmdb_id="{{ item.movie.ids.tmdb }}"
  		  >
    			<div
    			  class="goto_{{ type[:-1]|lower }} addloading"
    				data-id="{{ item.movie.ids.slug }}"
    			>
    			  <img alt="" src="{{ item.movie.images.poster.thumb }}" height="141" width="95"/>
    
    			  {% if item.movie.in_collection %}
    				  <div class="collection"></div>
    			  {% endif %}
    			  {% if item.movie.in_watchlist %}
    				  <div class="watchlist"></div>
    			  {% endif %}
    			  {% if item.movie.rating %}
    				{% if item.movie.rating == 'love' %}
    				  <div class="love"></div>
    				{% elif item.movie.rating == 'hate' %}
    				  <div class="hate"></div>
    				{% endif %}
    			  {% endif %}
    			  {% if item.movie.watched %}
    				  <div class="watched"></div>
    			  {% endif %}
    			</div>
  
    			<div class="overlay_menu" align="center">
    			  {% if not item.movie.watched %}
    				  <div class="mark_watched" title="Mark as watched"></div>
    			  {% endif %}
    			  {% if not item.movie.in_watchlist %}
    				  <div class="add_watchlist" title="Add to watchlist"></div>
    			  {% endif %}
    			    <div class="add_customlist" title="Add to custom list"></div>
    			  {% if not item.movie.in_collection %}
    				  <div class="add_collection" title="Add to collection"></div>
    			  {% endif %}
    			</div>
  			  <div class="footer">
    			  <div class="item_info">
    			    <span class="percentage">{{ (item.movie.rating * 10)|round|int }}%</span>
    			    <span class="votes">{{ item.movie.votes }} votes</span>
    			  </div>
    			  <div class="item_rate" align="center">
    				  <div class="rate r_love {{ 'rated' if item.movie.rating == 'love' }}" data-rating="love" {% if item.movie.rating == 'love' %}title="Unrate"{% else %}title="Loved"{% endif %}></div>
    				  <div class="rate r_hate {{ 'rated' if item.movie.rating == 'hate' }}" data-rating="hate" {% if item.movie.rating == 'hate' %}title="Unrate"{% else %}title="Hated"{% endif %}></div>
    			  </div>
  			  </div>
  		  </div>
  		{% endfor %}
  	{% endif %}
  </div>
  <div id="pages">
  </div>

  <script>
    function generatePages() {
      var _total, i, _link;
      _total = $('#carousel').rcarousel('getTotalPages');

      for (i = 0; i < _total; i++) {
        _link = $('<div>page</div>');

        $(_link).bind('click', {page: i},function(e) {
          $('#carousel').rcarousel('goToPage', e.data.page);
          e.preventDefault();
        }).addClass('bullet off').appendTo('#pages');
      }
      $('div:eq(0)', '#pages').removeClass('off').addClass('on').css('background', 'url(' + WEBROOT + '/static/images/alpha/fff_40.png)');
    }

    function pageLoaded(e, data) {
      $('div.on', '#pages').removeClass('on').css('background', '');
      $('div', '#pages').eq(data.page).addClass('on').css('background', 'url(' + WEBROOT + '/static/images/alpha/fff_40.png)');
    }

    $('#carousel').rcarousel({
      visible: 4,
      step: 4,
      auto: {
        enabled: true,
        interval: 3000,
        direction: 'next'
      },
      navigation: {
        prev: '.trending_prev',
        next: '.trending_next'
      },
      height: 166,
      width: 95,
      margin: 5,
      start: generatePages,
      pageLoaded: pageLoaded
    });
  </script>
</div>

{% endif %}
{% endblock %}
